<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DragonCP</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="https://blog.infinitysystems.in/dragondbserver/DragonDB_Trans.png" alt="DragonCP Logo" class="navbar-logo">
                <span class="navbar-brand-text">DRAGON-CP</span>
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text version-badge me-3">
                   v1.8.2
                </span>
                <button class="btn btn-outline-light btn-sm me-2" id="configBtn">
                    <i class="bi bi-gear"></i> Config
                </button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Status Bar -->
        <div class="status-bar fade-in" id="statusBar" title="">
            <div class="status-info">
                <span class="status-indicator" id="statusIndicator"></span>
                <span class="status-message" id="statusMessage">Initializing application...</span>
            </div>
            <div class="status-actions">
                <button class="btn btn-outline-light btn-sm me-2" id="collapseAllBtn" title="Collapse all cards">
                    <i class="bi bi-chevron-up"></i><span> Collapse All</span>
                </button>
                <button class="btn btn-primary btn-sm" id="autoConnectBtn" style="display: none;">
                    <i class="bi bi-wifi"></i> Auto Connect
                </button>
                <button class="btn btn-danger btn-sm" id="disconnectBtn" style="display: none;">
                    <i class="bi bi-wifi-off"></i> Disconnect
                </button>
            </div>
        </div>

        <!-- Disk Usage -->
        <div class="card mb-4 fade-in" id="diskUsageCard" style="display: none;">
            <div class="card-header gradient-accent collapsible-header" data-card-id="diskUsageCard">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-hdd"></i>
                        <span class="fw-semibold">Disk Usage Monitor</span>
                        <i class="bi bi-chevron-down collapse-icon"></i>
                    </div>
                    <div class="d-flex align-items-center btn-group">
                        <button class="btn btn-outline-light btn-sm" id="refreshDiskUsageBtn" title="Refresh disk usage">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body collapsible-content">
                <div class="row" id="diskUsageInfo">
                    <!-- Disk usage info will be loaded here -->
                </div>
                <div class="text-center mt-2">
                    <small class="text-muted" id="diskUsageLastUpdate">
                        <i class="bi bi-clock"></i> Click refresh button to update disk usage
                    </small>
                </div>
            </div>
        </div>

        <!-- Active Transfers Management -->
        <div class="card mb-4 fade-in" id="transferManagementCard" style="display: none;">
            <div class="card-header gradient-accent collapsible-header" data-card-id="transferManagementCard">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-arrow-repeat"></i>
                        <span class="fw-semibold">Active Transfers</span>
                        <span class="badge bg-light text-dark" id="activeTransferCount">0 active</span>
                        <i class="bi bi-chevron-down collapse-icon"></i>
                    </div>
                    <div class="d-flex align-items-center btn-group">
                        <button class="btn btn-outline-light btn-sm" id="refreshTransfersBtn" title="Refresh transfer list">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                        <button class="btn btn-outline-light btn-sm" id="showAllTransfersBtn" title="Show all transfers">
                            <i class="bi bi-list"></i> All
                        </button>
                        <button class="btn btn-outline-light btn-sm" id="cleanupTransfersBtn" title="Remove duplicate transfers">
                            <i class="bi bi-trash"></i> Cleanup
                        </button>
                        <button class="btn btn-outline-light btn-sm" id="manageBackupsBtn" title="Backup & Restore">
                            <i class="bi bi-archive"></i> Backups
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body collapsible-content">
                <div class="row" id="transferList">
                    <!-- Transfer items will be loaded here -->
                </div>
                <div class="text-center mt-3" id="noTransfersMessage" style="display: none;">
                    <div class="text-muted">
                        <i class="bi bi-info-circle"></i> No active transfers found
                    </div>
                </div>
            </div>
        </div>

        <!-- Backup & Restore Card -->
        <div class="card mb-4 fade-in" id="backupsCard" style="display: none;">
            <div class="card-header gradient-accent collapsible-header" data-card-id="backupsCard">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-archive"></i>
                        <span class="fw-semibold">Backup & Restore</span>
                        <i class="bi bi-chevron-down collapse-icon"></i>
                    </div>
                    <div class="d-flex align-items-center btn-group">
                        <button class="btn btn-outline-light btn-sm" id="refreshBackupsBtn" title="Refresh backups">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                        <button class="btn btn-outline-light btn-sm" id="importBackupsBtn" title="Scan backup directory and import">
                            <i class="bi bi-download"></i> Import from Disk
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body collapsible-content">
                <!-- Backups breadcrumb -->
                <div class="browse-breadcrumb mb-2" id="backupsBreadcrumb" style="display:none;">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-0" id="backupsBreadcrumbItems"></ol>
                    </nav>
                </div>

                <div class="d-flex justify-content-between mb-2">
                    <div class="text-muted small" id="backupsSummary"></div>
                    <div>
                        <span class="badge bg-secondary" id="selectedFilesCount" style="display:none;">0 selected</span>
                    </div>
                </div>
                <!-- Stage 1: Backups list -->
                <div id="backupsListSection">
                    <div class="table-responsive" style="max-height: 55vh; overflow:auto">
                        <table class="table table-dark table-striped table-hover table-sm align-middle">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Type</th>
                                    <th>Files</th>
                                    <th>Size</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="backupsTable"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Stage 2: Files of a backup -->
                <div id="backupFilesSection" style="display:none;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="text-muted small" id="backupFilesMeta"></div>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-success" id="restoreSelectedBtn"><i class="bi bi-arrow-counterclockwise"></i> Restore Selected</button>
                            <button class="btn btn-outline-success" id="restoreAllBtn"><i class="bi bi-arrow-counterclockwise"></i> Restore All</button>
                        </div>
                    </div>
                    <div class="table-responsive" style="max-height: 50vh; overflow:auto">
                        <table class="table table-dark table-striped table-hover table-sm align-middle">
                            <thead>
                                <tr>
                                    <th style="width:40px;"><input type="checkbox" id="backupFilesSelectAll"></th>
                                    <th>Context</th>
                                    <th>Backup Path</th>
                                    <th>Size</th>
                                    <th>Modified</th>
                                </tr>
                            </thead>
                            <tbody id="backupFilesTable"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Stage 3: Restore Confirmation -->
                <div id="backupConfirmSection" style="display:none;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0 text-light">Planned Changes</h6>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-primary" id="applyRestoreBtn"><i class="bi bi-check2-circle"></i> Apply Changes</button>
                            <button class="btn btn-outline-secondary" id="cancelRestoreBtn"><i class="bi bi-arrow-left"></i> Back</button>
                        </div>
                    </div>
                    <div id="restorePlanContainer">
                        <div class="table-responsive" style="max-height: 45vh; overflow:auto">
                            <table class="table table-dark table-striped table-hover table-sm align-middle">
                                <thead>
                                    <tr>
                                        <th style="width: 50%;">Backup File & Context</th>
                                        <th style="width: 50%;">Will Replace / Copy To</th>
                                    </tr>
                                </thead>
                                <tbody id="restorePlanTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Stage 3b: Delete Confirmation -->
                <div id="backupDeleteSection" style="display:none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0 text-light">Delete Backup</h6>
                        <button class="btn btn-outline-secondary btn-sm" id="cancelDeleteBtn"><i class="bi bi-arrow-left"></i> Back</button>
                    </div>
                    
                    <!-- Delete Options -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title"><i class="bi bi-exclamation-triangle text-warning"></i> What would you like to delete?</h6>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="deleteRecordCheck" checked>
                                <label class="form-check-label text-light" for="deleteRecordCheck">
                                    <strong>Database Record</strong> - Remove backup entry from database
                                </label>
                                <div class="text-muted small ms-4">This will remove the backup from the list but keep files on disk</div>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="deleteFilesCheck">
                                <label class="form-check-label text-light" for="deleteFilesCheck">
                                    <strong>Backup Files</strong> - Delete all backup files from disk
                                </label>
                                <div class="text-warning small ms-4"><i class="bi bi-exclamation-triangle"></i> This will permanently delete all files in the backup directory (NOT your original media)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Files to be deleted (shown when deleteFilesCheck is checked) -->
                    <div id="deleteFilesPreview" style="display:none;">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-files text-danger"></i> Backup files to be deleted</h6>
                                <small class="text-warning"><i class="bi bi-shield-exclamation"></i> These files will be deleted from the backup directory only</small>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive" style="max-height: 30vh; overflow:auto">
                                    <table class="table table-dark table-striped table-hover table-sm">
                                        <thead>
                                            <tr>
                                                <th style="width: 80%;">Backup File Path</th>
                                                <th style="width: 20%;" class="text-center">Size</th>
                                            </tr>
                                        </thead>
                                        <tbody id="deleteFilesTable"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Delete Actions -->
                    <div class="d-flex justify-content-end gap-2 mt-3">
                        <button class="btn btn-outline-secondary" id="cancelDeleteBtn2"><i class="bi bi-x"></i> Cancel</button>
                        <button class="btn btn-danger" id="confirmDeleteBtn" disabled><i class="bi bi-trash"></i> Delete Selected</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Movie Sync Card -->
        <div class="card mb-4 fade-in" id="movieSyncCard" style="display: none;">
            <div class="card-header gradient-accent collapsible-header" data-card-id="movieSyncCard">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-film"></i>
                        <span class="fw-semibold">Media Sync</span>
                        <i class="bi bi-chevron-down collapse-icon"></i>
                        <span class="ms-2 badge bg-light text-dark" id="syncNotificationCount">0 pending</span>
                    </div>
                    <div class="d-flex align-items-center btn-group">
                        <button class="btn btn-outline-light btn-sm" id="refreshSyncBtn" title="Refresh notifications">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                        <button class="btn btn-outline-light btn-sm" id="autoSyncToggleBtn" title="Toggle auto-sync">
                            <i class="bi bi-toggle-off"></i> Auto-Sync: OFF
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body collapsible-content">
                <div id="movieNotificationsList" class="movie-notifications-container">
                    <!-- Movie notifications will be loaded here as stacked cards -->
                </div>
                <div class="text-center mt-3" id="noNotificationsMessage" style="display: none;">
                    <div class="text-muted">
                        <i class="bi bi-film"></i> No movie notifications found
                        <div class="mt-2 small">
                            Movie notifications will appear here when received from webhook.
                        </div>
                    </div>
                </div>
                
                
            </div>
        </div>

        <!-- Browse Media -->
        <div class="card mb-4 fade-in" id="browseMediaCard" style="display: none;">
            <div class="card-header gradient-accent collapsible-header" data-card-id="browseMediaCard">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-collection-play" id="browseMediaIcon"></i>
                        <span class="fw-semibold" id="browseMediaTitle">Browse Media</span>
                        <i class="bi bi-chevron-down collapse-icon"></i>
                    </div>
                </div>
            </div>
            <div class="card-body collapsible-content">
                <!-- Breadcrumb Navigation -->
                <div class="browse-breadcrumb mb-3" id="browseMediaBreadcrumb" style="display: none;">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-0" id="breadcrumb">
                            <!-- Breadcrumb will be populated -->
                        </ol>
                    </nav>
                </div>
                
                <!-- Search and Sort Controls -->
                <div class="browse-controls mb-3" id="browseControls" style="display: none;">
                    <div class="row g-2 align-items-center">
                        <div class="col-md-6 col-12">
                            <div class="input-group input-group-sm">
                                <span class="input-group-text">
                                    <i class="bi bi-search"></i>
                                </span>
                                <input type="text" class="form-control" 
                                       id="folderSearchInput" 
                                       placeholder="Search folders...">
                                <button class="btn btn-outline-light" type="button" id="clearSearchBtn" style="display: none;">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-4 col-8">
                            <div class="input-group input-group-sm">
                                <span class="input-group-text">
                                    <i class="bi bi-funnel"></i>
                                </span>
                                <select class="form-select" id="folderSortSelect">
                                    <option value="recent">Recently Updated</option>
                                    <option value="alphabetical">Alphabetical A-Z</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2 col-4 d-flex align-items-center justify-content-end gap-2">
                            <button class="btn btn-outline-light btn-sm" id="refreshSyncStatusBtn" title="Refresh sync status">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                            <small class="text-muted" id="folderCount">0 folders</small>
                        </div>
                    </div>
                </div>

                <!-- Media Type Selection View -->
                <div id="mediaTypeView">
                    <div class="row" id="mediaTypes">
                        <!-- Media types will be loaded here -->
                    </div>
                </div>

                <!-- Folder Browser View -->
                <div id="folderBrowserView" style="display: none;">
                    <div class="loading-spinner text-center mb-3" id="folderLoadingSpinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div class="folder-browser-container">
                        <div id="folderList">
                            <!-- Folders will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transfer Management -->
        <div class="card mb-4 fade-in" id="transferCard" style="display: none;">
            <div class="card-header gradient-accent collapsible-header" data-card-id="transferCard">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-gear"></i>
                        <span class="fw-semibold">Current Transfer (Legacy)</span>
                        <i class="bi bi-chevron-down collapse-icon"></i>
                    </div>
                </div>
            </div>
            <div class="card-body collapsible-content">
                <div id="activeTransfers">
                    <!-- Active transfers will be shown here -->
                </div>
            </div>
        </div>

        <!-- Transfer Log -->
        <div class="card fade-in" id="logCard" style="display: none;">
            <div class="card-header gradient-accent collapsible-header" data-card-id="logCard">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-terminal"></i>
                        <span class="fw-semibold">Transfer Logs</span>
                        <span class="badge bg-secondary" id="logCount">0 active</span>
                        <i class="bi bi-chevron-down collapse-icon"></i>
                    </div>
                    <div class="log-controls d-flex align-items-center btn-group">
                        <button class="btn btn-sm btn-outline-light" id="clearLogBtn" title="Clear current tab logs">
                            <i class="bi bi-trash"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-light" id="autoScrollBtn" title="Auto-scroll to newest">
                            <i class="bi bi-arrow-up-circle-fill"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-light" id="fullscreenLogBtn" title="Fullscreen current tab">
                            <i class="bi bi-arrows-fullscreen"></i>
                        </button>
                    </div>
                </div>
                <!-- Tab Navigation -->
                <div class="log-tabs mt-2" id="logTabsContainer" style="display: none;">
                    <nav class="nav nav-tabs log-nav-tabs" id="logTabs" role="tablist">
                        <!-- Tabs will be added dynamically -->
                    </nav>
                </div>
            </div>
            <div class="card-body p-0 collapsible-content">
                <!-- Single log display (when no tabs) -->
                <div class="transfer-log-container" id="singleLogContainer">
                    <div class="transfer-log" id="transferLog">
                        <!-- Single transfer logs will be shown here -->
                    </div>
                </div>
                
                <!-- Tabbed log display (when multiple transfers) -->
                <div class="tab-content" id="logTabContent" style="display: none;">
                    <!-- Tab panes will be added dynamically -->
                </div>
                
                <!-- No logs message -->
                <div class="text-center p-4 text-muted" id="noLogsMessage" style="display: none;">
                    <i class="bi bi-info-circle"></i> No transfer logs available
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Log Modal -->
    <div class="log-fullscreen-modal" id="fullscreenLogModal">
        <div class="log-fullscreen-header">
            <h5><i class="bi bi-terminal"></i> Transfer Log - Fullscreen</h5>
            <button class="log-fullscreen-close" id="closeFullscreenLog">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="log-fullscreen-content">
            <div class="log-fullscreen-log" id="fullscreenTransferLog">
                <!-- Fullscreen logs will be shown here -->
            </div>
        </div>
    </div>

    <!-- Configuration Modal -->
    <div class="modal fade" id="configModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header gradient-accent">
                    <h5 class="modal-title">
                        <i class="bi bi-gear"></i> Configuration
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="configForm">
                        <!-- App Connection Settings -->
                        <div class="config-section">
                            <h6><i class="bi bi-wifi"></i> App Connection Settings</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="websocketTimeout" class="form-label">Auto-Disconnect Timeout (minutes)</label>
                                        <input type="number" class="form-control" id="websocketTimeout" name="WEBSOCKET_TIMEOUT_MINUTES" min="5" max="60" value="30" placeholder="30">
                                        <div class="modified-indicator" id="websocketTimeoutIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="websocketTimeoutOriginal"></div>
                                        <small class="form-text text-muted">
                                            <i class="bi bi-info-circle"></i> 
                                            App will disconnect after this period of inactivity (5-60 minutes). 
                                            Transfer monitoring continues automatically. Higher values use more server resources.
                                        </small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label class="form-label">Current Connection Status</label>
                                        <div class="form-control-plaintext">
                                            <div class="d-flex align-items-center">
                                                <span class="status-indicator" id="wsConfigStatusIndicator"></span>
                                                <span class="text-light fw-semibold" id="wsConfigStatusText">Checking...</span>
                                                <span class="badge bg-info ms-2" id="wsActiveConnectionsCount" style="display: none;">0</span>
                                                <button type="button" class="btn btn-outline-secondary btn-sm ms-2" id="refreshWsStatusBtn" title="Refresh connection status">
                                                    <i class="bi bi-arrow-clockwise"></i>
                                                </button>
                                            </div>
                                            <small class="text-muted" id="wsConfigStatusDetails">
                                                Real-time transfer updates depend on app connection.
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Discord Notifications -->
                        <div class="config-section">
                            <h6><i class="bi bi-discord"></i> Discord Notifications</h6>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="config-field">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="discordNotificationsEnabled" name="DISCORD_NOTIFICATIONS_ENABLED">
                                            <label class="form-check-label" for="discordNotificationsEnabled">
                                                <strong>Enable Discord Notifications</strong>
                                            </label>
                                            <div class="modified-indicator" id="discordNotificationsEnabledIndicator" style="display: none;">
                                                <i class="bi bi-pencil-square"></i>
                                            </div>
                                            <div class="original-value" id="discordNotificationsEnabledOriginal"></div>
                                            <small class="form-text text-muted d-block mt-1">
                                                <i class="bi bi-info-circle"></i> 
                                                When enabled, Discord notifications will be sent for transfer completion events
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" id="discordConfigFields">
                                <div class="col-md-12">
                                    <div class="config-field">
                                        <label for="discordWebhookUrl" class="form-label">Discord Webhook URL</label>
                                        <input type="text" class="form-control" id="discordWebhookUrl" name="DISCORD_WEBHOOK_URL" placeholder="https://discord.com/api/webhooks/...">
                                        <div class="modified-indicator" id="discordWebhookUrlIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="discordWebhookUrlOriginal"></div>
                                        <small class="form-text text-muted">
                                            <i class="bi bi-info-circle"></i> 
                                            Discord webhook URL for transfer completion notifications
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="row" id="discordConfigFields2">
                                <div class="col-md-4">
                                    <div class="config-field">
                                        <label for="discordAppUrl" class="form-label">App URL</label>
                                        <input type="text" class="form-control" id="discordAppUrl" name="DISCORD_APP_URL" placeholder="http://localhost:5000">
                                        <div class="modified-indicator" id="discordAppUrlIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="discordAppUrlOriginal"></div>
                                        <small class="form-text text-muted">URL to link back to DragonCP in Discord notifications</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="config-field">
                                        <label for="discordIconUrl" class="form-label">Icon URL</label>
                                        <input type="text" class="form-control" id="discordIconUrl" name="DISCORD_ICON_URL" placeholder="https://example.com/icon.png">
                                        <div class="modified-indicator" id="discordIconUrlIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="discordIconUrlOriginal"></div>
                                        <small class="form-text text-muted">Icon URL for Discord notification author</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="config-field">
                                        <label for="discordManualSyncThumbnailUrl" class="form-label">Alt Thumbnail URL</label>
                                        <input type="text" class="form-control" id="discordManualSyncThumbnailUrl" name="DISCORD_MANUAL_SYNC_THUMBNAIL_URL" placeholder="https://example.com/thumbnail.png">
                                        <div class="modified-indicator" id="discordManualSyncThumbnailUrlIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="discordManualSyncThumbnailUrlOriginal"></div>
                                        <small class="form-text text-muted">Thumbnail for manual sync notifications</small>
                                    </div>
                                </div>
                            </div>
                            <div class="row" id="discordConfigActions">
                                <div class="col-md-12">
                                    <div class="d-flex gap-2 mt-3">
                                        <button type="button" class="btn btn-success" id="testDiscordBtn">
                                            <i class="bi bi-send"></i> Test Discord Notification
                                        </button>
                                        <button type="button" class="btn btn-info" id="loadDiscordSettingsBtn">
                                            <i class="bi bi-arrow-clockwise"></i> Load Current Settings
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- SSH Connection Settings -->
                        <div class="config-section">
                            <h6><i class="bi bi-wifi"></i> SSH Connection Settings</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="remoteIp" class="form-label">Server Host/IP</label>
                                        <input type="text" class="form-control" id="remoteIp" name="REMOTE_IP" placeholder="192.168.1.100">
                                        <div class="modified-indicator" id="remoteIpIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="remoteIpOriginal"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="remoteUser" class="form-label">Username</label>
                                        <input type="text" class="form-control" id="remoteUser" name="REMOTE_USER" placeholder="username">
                                        <div class="modified-indicator" id="remoteUserIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="remoteUserOriginal"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="remotePassword" class="form-label">Password (optional)</label>
                                        <input type="password" class="form-control" id="remotePassword" name="REMOTE_PASSWORD" placeholder="Leave empty if using SSH key">
                                        <div class="modified-indicator" id="remotePasswordIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="remotePasswordOriginal"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="sshKeyPath" class="form-label">SSH Key Path (optional)</label>
                                        <input type="text" class="form-control" id="sshKeyPath" name="SSH_KEY_PATH" placeholder="/path/to/private/key">
                                        <div class="modified-indicator" id="sshKeyPathIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="sshKeyPathOriginal"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Media Paths -->
                        <div class="config-section">
                            <h6><i class="bi bi-collection-play"></i> Media Source Paths</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="moviePath" class="form-label">Movie Path</label>
                                        <input type="text" class="form-control" id="moviePath" name="MOVIE_PATH" placeholder="/path/to/movies">
                                        <div class="modified-indicator" id="moviePathIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="moviePathOriginal"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="tvshowPath" class="form-label">TV Show Path</label>
                                        <input type="text" class="form-control" id="tvshowPath" name="TVSHOW_PATH" placeholder="/path/to/tvshows">
                                        <div class="modified-indicator" id="tvshowPathIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="tvshowPathOriginal"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="animePath" class="form-label">Anime Path</label>
                                        <input type="text" class="form-control" id="animePath" name="ANIME_PATH" placeholder="/path/to/anime">
                                        <div class="modified-indicator" id="animePathIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="animePathOriginal"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="backupPath" class="form-label">Backup Path</label>
                                        <input type="text" class="form-control" id="backupPath" name="BACKUP_PATH" placeholder="/path/to/backup">
                                        <div class="modified-indicator" id="backupPathIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="backupPathOriginal"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Destination Paths -->
                        <div class="config-section">
                            <h6><i class="bi bi-folder-check"></i> Local Destination Paths</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="movieDestPath" class="form-label">Movie Destination</label>
                                        <input type="text" class="form-control" id="movieDestPath" name="MOVIE_DEST_PATH" placeholder="/local/path/to/movies">
                                        <div class="modified-indicator" id="movieDestPathIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="movieDestPathOriginal"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="tvshowDestPath" class="form-label">TV Show Destination</label>
                                        <input type="text" class="form-control" id="tvshowDestPath" name="TVSHOW_DEST_PATH" placeholder="/local/path/to/tvshows">
                                        <div class="modified-indicator" id="tvshowDestPathIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="tvshowDestPathOriginal"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="animeDestPath" class="form-label">Anime Destination</label>
                                        <input type="text" class="form-control" id="animeDestPath" name="ANIME_DEST_PATH" placeholder="/local/path/to/anime">
                                        <div class="modified-indicator" id="animeDestPathIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="animeDestPathOriginal"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Disk Monitoring -->
                        <div class="config-section">
                            <h6><i class="bi bi-hdd"></i> Disk Usage Monitoring</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="config-field">
                                        <label for="diskPath1" class="form-label">Local Disk Path 1</label>
                                        <input type="text" class="form-control" id="diskPath1" name="DISK_PATH_1" placeholder="/path/to/disk1">
                                        <div class="modified-indicator" id="diskPath1Indicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="diskPath1Original"></div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="config-field">
                                        <label for="diskPath2" class="form-label">Local Disk Path 2</label>
                                        <input type="text" class="form-control" id="diskPath2" name="DISK_PATH_2" placeholder="/path/to/disk2">
                                        <div class="modified-indicator" id="diskPath2Indicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="diskPath2Original"></div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="config-field">
                                        <label for="diskPath3" class="form-label">Local Disk Path 3</label>
                                        <input type="text" class="form-control" id="diskPath3" name="DISK_PATH_3" placeholder="/path/to/disk3">
                                        <div class="modified-indicator" id="diskPath3Indicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="diskPath3Original"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="diskApiEndpoint" class="form-label">Remote Disk API Endpoint</label>
                                        <input type="text" class="form-control" id="diskApiEndpoint" name="DISK_API_ENDPOINT" placeholder="https://api.example.com/disk-usage">
                                        <div class="modified-indicator" id="diskApiEndpointIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="diskApiEndpointOriginal"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="config-field">
                                        <label for="diskApiToken" class="form-label">Remote Disk API Token</label>
                                        <input type="password" class="form-control" id="diskApiToken" name="DISK_API_TOKEN" placeholder="Bearer token for remote API">
                                        <div class="modified-indicator" id="diskApiTokenIndicator" style="display: none;">
                                            <i class="bi bi-pencil-square"></i>
                                        </div>
                                        <div class="original-value" id="diskApiTokenOriginal"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning me-auto" id="resetConfigBtn">
                        <i class="bi bi-arrow-clockwise"></i> Reset to Env Values
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveConfig">
                        <i class="bi bi-check-circle"></i> Save Configuration
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- All Transfers Modal -->
    <div class="modal fade" id="allTransfersModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header gradient-accent">
                    <h5 class="modal-title">
                        <i class="bi bi-list"></i> All Transfers
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <label for="transferStatusFilter" class="form-label">Filter by Status:</label>
                            <select class="form-select form-select-sm d-inline-block w-auto ms-2" id="transferStatusFilter">
                                <option value="">All Statuses</option>
                                <option value="running">Running</option>
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="failed">Failed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <button class="btn btn-primary btn-sm" id="refreshAllTransfersBtn">
                            <i class="bi bi-arrow-clockwise"></i> Refresh
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-dark">
                            <thead class="table-dark">
                                <tr>
                                    <th>Title</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Progress</th>
                                    <th>Started</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="allTransfersTable">
                                <!-- All transfers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center mt-3" id="noAllTransfersMessage" style="display: none;">
                        <div class="text-muted">
                            <i class="bi bi-info-circle"></i> No transfers found
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transfer Details Modal -->
    <div class="modal fade" id="transferDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header gradient-accent">
                    <h5 class="modal-title">
                        <i class="bi bi-info-circle"></i> Transfer Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="transferDetailsContent">
                        <!-- Transfer details will be loaded here -->
                    </div>
                    <div class="mt-3">
                        <h6>Transfer Logs:</h6>
                        <div class="transfer-log-container" style="height: 300px;">
                            <div class="transfer-log" id="transferDetailsLog">
                                <!-- Transfer logs will be shown here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <!-- Custom JS -->
    <script type="module" src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html> 